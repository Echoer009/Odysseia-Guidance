# Odysseia Guidance & Brain-Girl AI Bot

这是一个功能强大的、双核心驱动的 Discord 机器人项目，旨在为社区提供从新成员引导到高级AI互动的一体化解决方案。

---

## 核心模块概览

项目由两大核心模块构成，它们既可以协同工作，也能够独立运行：

1.  **奥德赛引导模块 (Odysseia Guidance)**
    *   **定位**: 一个为 Discord 服务器设计的自动化、多阶段、可定制的新成员引导系统。
    *   **核心思想**: 根据新成员选择的兴趣标签，为他们生成一条个性化的频道浏览路径，并像向导一样带领他们按顺序访问这些频道，最终帮助他们无缝融入社区。

2.  **类脑娘AI模块 (Brain-Girl AI)**
    *   **定位**: 一个基于 Google Gemini 模型的先进AI伴侣，拥有复杂的记忆系统和丰富的互动功能。
    *   **核心思想**: 不仅仅是一个问答机器人，而是一个能够与用户建立长期联系、拥有“记忆”和“个性”的虚拟社区成员，并通过内置的经济和社交系统提升社区活跃度。

---

## ✨ 功能特性

### 引导模块 (Guidance)

-   **自动化流程**: 当成员获得特定身份组后，引导流程自动触发，无需管理员干预。
-   **个性化路径**: 根据用户选择的多个兴趣标签，动态生成独一无二的引导路径。
-   **多阶段引导**: 支持设置“缓冲区”和“已验证”等多个阶段，在用户获得不同身份组时解锁新的引导路径。
-   **分步式引导**: 在每个引导频道中，用户通过点击按钮来获取详细介绍并前往下一站，确保了流程的连贯性。
-   **统一管理面板**: 管理员可以通过一个统一的 `/新人引导管理面板` 命令，完成对触发身份组、消息模板、兴趣标签、引导路径、频道专属消息和一键部署等所有功能的配置。
-   **持久化进程**: 用户进度和服务器配置存储在 SQLite 数据库中，机器人重启后所有状态均可恢复。

### AI模块 (Brain-Girl)

-   **先进的AI模型**: 基于 Google `gemini-pro` 模型，提供高质量的对话体验。
-   **多层记忆系统**:
    -   **短期记忆**: 能够理解并回应当前对话的上下文。
    -   **长期个人记忆**: 当与用户的对话达到一定量后，会自动将历史对话总结为永久的“个人摘要”。这份摘要会在未来的对话中被调用，让AI真正“记住”用户。
    -   **社区知识库 (世界之书)**: 通过**检索增强生成 (RAG)** 技术，AI可以查询内置的社区知识库（基于ChromaDB向量数据库），回答关于服务器的特定问题。
-   **丰富的互动生态**:
    -   **好感度系统**: 用户与AI的互动会影响彼此的好感度。
    -   **经济系统 (类脑币)**: 用户可通过每日签到、发帖等行为赚取“类脑币”。
    -   **商店系统**: 用户可使用“类脑币”购买特殊物品，如用于解锁“个人记忆”功能的道具。
-   **多模态能力**: 支持识别和理解用户发送的图片内容。

---

## 🚀 部署指南

### 1. 环境准备

-   Python 3.10 或更高版本
-   一个 Discord Bot 账号并获取其 Token
-   一个 Google Gemini API 密钥

### 2. 克隆或下载项目

```bash
git clone [你的仓库URL]
cd [项目目录]
```

### 3. 安装依赖

项目依赖存储在 `requirements.txt` 中。建议在虚拟环境中安装：

```bash
# 创建虚拟环境 (可选但推荐)
python -m venv venv

# 激活虚拟环境
# Windows
venv\Scripts\activate
# macOS / Linux
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt
```

### 4. 配置机器人

1.  找到项目根目录下的 `.env.example` 文件，并将其复制为 `.env`。
2.  打开 `.env` 文件，填入你的配置信息。

    ```env
    # .env file

    # --- 必需配置 ---
    # 你的 Discord 机器人令牌
    DISCORD_TOKEN="YOUR_DISCORD_TOKEN_HERE"
    # 你的 Gemini API 密钥
    GEMINI_API_KEY="YOUR_GEMINI_API_KEY_HERE"

    # --- 核心配置 ---
    # (可选) 用于在开发时快速同步斜杠命令的服务器（公会）ID
    # 如果留空，命令将进行全局同步（可能需要长达一小时才能生效）
    GUILD_ID="YOUR_DEVELOPMENT_GUILD_ID_HERE"

    # --- 权限控制 ---
    # (可选) 拥有管理面板访问权限的开发者用户ID，多个ID请用逗号分隔
    DEVELOPER_USER_IDS="YOUR_USER_ID_1,YOUR_USER_ID_2"
    # (可选) 拥有管理面板访问权限的身份组ID，多个ID请用逗号分隔
    ADMIN_ROLE_IDS="YOUR_ROLE_ID_1,YOUR_ROLE_ID_2"
    ```

### 5. 邀请机器人

使用以下链接将你的机器人邀请到你的服务器。请确保在邀请时勾选 **“机器人(Bot)”** 和 **“应用程序命令(applications.commands)”** 权限。

`https://discord.com/api/oauth2/authorize?client_id=你的机器人CLIENT_ID&permissions=8&scope=bot%20applications.commands`

> **注意**: 你需要将 `你的机器人CLIENT_ID` 替换为你在 Discord Developer Portal 中找到的 Application ID。`permissions=8` 代表给予管理员权限，这是最简单的方式；你也可以根据需要精确计算权限值。

### 6. 运行机器人

在项目根目录下，使用以下命令运行机器人：

```bash
python -m src.main
```

如果一切顺利，你的终端会显示机器人已成功登录。

---

## 📖 使用方法

### 管理员

-   **新成员引导**: 所有引导相关的功能都集成在 `/新人引导管理面板` 命令中。
-   **AI 功能管理**: AI相关的管理命令（如黑名单、世界之书贡献等）也已集成到相应的Cog中，可通过斜杠命令访问。

### 普通用户

-   **参与引导**: 根据机器人发送的私信提示，点击按钮选择兴趣标签，即可开始你的社区探索之旅。
-   **与AI互动**: 在任何频道中 `@机器人` 即可开始对话。
-   **探索更多功能**: 尝试使用 `/个人档案`, `/商店`, `/抽鬼牌` 等命令，体验更丰富的互动内容。