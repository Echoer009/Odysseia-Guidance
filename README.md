# Odysseia Guidance - 奥德赛引导机器人

一个为 Discord 服务器设计的自动化新成员引导系统。其核心思想是，根据新成员选择的兴趣标签，为他们生成一条个性化的频道浏览路径，并引导他们按顺序访问这些频道，最终帮助他们快速融入服务器。

---

## ✨ 功能特性

- **自动化流程**: 当成员获得特定身份组后，引导流程自动触发。
- **个性化路径**: 根据用户选择的多个兴趣标签，动态生成独一无二的引导路径。
- **分步式引导**: 在每个引导频道中，用户通过点击按钮来获取详细介绍并前往下一站，确保了流程的连贯性。
- **统一管理面板**: 管理员可以通过一个统一的 `/新人引导管理面板` 命令，完成对触发身份组、消息模板、兴趣标签、引导路径、频道专属消息和一键部署等所有功能的配置。
- **灵活的权限控制**: 可通过环境变量精细控制哪些用户或角色有权访问管理面板。
- **友好的用户界面**: 大量使用 Discord 的视图（View）、模态窗口（Modal）和嵌入式消息（Embed），为管理员和新成员提供流畅的交互体验。
- **持久化进程**: 用户进度和服务器配置存储在 SQLite 数据库中，机器人重启后所有状态均可恢复。

---

## 🚀 部署指南

### 1. 环境准备

- Python 3.10 或更高版本
- 一个 Discord Bot 账号并获取其 Token

### 2. 克隆或下载项目

```bash
git clone [你的仓库URL]
cd [项目目录]
```

### 3. 安装依赖

项目依赖存储在 `requirements.txt` 中。建议在虚拟环境中安装：

```bash
# 创建虚拟环境 (可选但推荐)
python -m venv venv

# 激活虚拟环境
# Windows
venv\Scripts\activate
# macOS / Linux
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt
```
*(注意: 我们需要创建一个 `requirements.txt` 文件)*

### 4. 配置机器人

1.  找到项目根目录下的 `.env.example` 文件，并将其复制为 `.env`。
2.  打开 `.env` 文件，填入你的配置信息。

    ```env
    # .env file

    # 你的 Discord 机器人令牌 (必需)
    DISCORD_TOKEN="YOUR_DISCORD_TOKEN_HERE"

    # (可选) 用于在开发时快速同步斜杠命令的服务器（公会）ID
    # 如果留空，命令将进行全局同步（可能需要长达一小时才能生效）
    GUILD_ID="YOUR_DEVELOPMENT_GUILD_ID_HERE"

    # (可选) 拥有管理面板访问权限的开发者用户ID，多个ID请用逗号分隔
    DEVELOPER_USER_IDS="YOUR_USER_ID_1,YOUR_USER_ID_2"

    # (可选) 拥有管理面板访问权限的身份组ID，多个ID请用逗号分隔
    ADMIN_ROLE_IDS="YOUR_ROLE_ID_1,YOUR_ROLE_ID_2"
    ```

### 5. 邀请机器人

使用以下链接将你的机器人邀请到你的服务器。请确保在邀请时勾选 **“机器人(Bot)”** 和 **“应用程序命令(applications.commands)”** 权限。

`https://discord.com/api/oauth2/authorize?client_id=你的机器人CLIENT_ID&permissions=8&scope=bot%20applications.commands`

> **注意**: 你需要将 `你的机器人CLIENT_ID` 替换为你在 Discord Developer Portal 中找到的 Application ID。`permissions=8` 代表给予管理员权限，这是最简单的方式；你也可以根据需要精确计算权限值。

### 6. 运行机器人

在项目根目录下，使用以下命令运行机器人：

```bash
python -m src.main
```

如果一切顺利，你的终端会显示机器人已成功登录。

---

## 📖 使用方法

所有管理功能都集成在 `/新人引导管理面板` 命令中。

- **权限**: 默认情况下，只有服务器所有者或拥有“管理员”权限的成员可以使用此命令。你也可以通过在 `.env` 文件中设置 `DEVELOPER_USER_IDS` 或 `ADMIN_ROLE_IDS` 来指定可以使用此命令的用户或角色。

- **命令**: `/新人引导管理面板`
  - **标签管理**: 创建、编辑和删除用于分类的兴趣标签。
  - **路径设置**: 为每个标签关联具体的引导频道或帖子。
  - **身份组配置**: 设置哪些身份组会触发新成员引导。
  - **消息模板**: 自定义引导流程中发送给用户的各种消息。
  - **频道消息设置**: 为引导路径中的特定频道配置专属的临时消息。
  - **一键部署**: 将配置好的引导面板自动部署到指定位置。

---

## 💡 推荐使用流程

1.  **基础配置**: 运行 `/新人引导管理面板`，进入“身份组配置”和“消息模板”完成基础设置。
2.  **创建标签**: 在管理面板中，进入“标签管理”，创建你希望新成员选择的兴趣领域，例如 "PVP玩家", "休闲玩家", "公会管理者"。
3.  **设置路径**: 进入“路径设置”，为上一步创建的每个标签指定一条或多条频道路径。
4.  **配置频道消息**: 进入“频道消息设置”，为每一个被你设置到路径中的频道定义该频道的介绍内容。
5.  **部署引导面板**: 进入“一键部署”，将引导面板部署到你希望新成员看到的起始频道。
6.  **完成**: 现在，当有成员获得你所设置的触发身份组时，整个流程就会自动开始！