### **SillyTavern (酒馆) 进阶功能速通指南简介**

欢迎！当你掌握了基础的聊天功能后，这篇指南将带你解锁酒馆的更多玩法，让你的 AI 体验更上一层楼。我们将逐一介绍如何自定义预设、管理对话、更新角色等核心技巧。

---RAG-CHUNK---

### **掌握预设：理解并定制AI体验的关键选项**

社区分享的预设充满了可开关的选项。理解这些选项，你就能精准地控制 AI 的行为。点击这些开关即可启用或禁用相应功能。以下是一些通用术语的解释：

*   **上下文 (Context):** 📦 指当前发送给 AI 的所有信息总和，包括角色设定、世界书、聊天记录等。'上下文长度'指的就是当前上下文在AI看来有多长。
*   **上下文长度（以词符数计）:** 🧠 决定 AI 的“记忆”容量。如果聊天记录太长，导致'上下文长度'的超过此数值，酒馆会自动不发送最早的聊天记录。
    * 通常保持预设作者推荐的默认值即可。
*   **最大回复长度（以词符数计）:** 📏 设定 AI 单次回复的最大字数。
    * 同样，建议使用预设作者给的默认值。
*   **流式传输:** 💧 开启后，AI 的回复会像打字一样逐字逐句显示，无需等待其全部生成完毕。
    *   ⚠️ **注意：** 使用 **AI Studio API** 的 Gemini 模型时，必须**关闭**此功能。否则，实时审查机制非常容易导致回复在输出中途被截断。
*   **总词符数:** 🔢 一个数字，显示在预设条目列表的上方，直观地告诉你：如果再发一条消息，需要使用多少上下文。
    * 如果出现AI回复质量下降的问题，建议先检查总词符数。对于Gemini 2.5 Pro，100k已经很多了。
    * 降低总词符数请看后文'总结'部分。
*   **头部:** 🧑‍🎨 预设最顶部的几个条目，用于定义 AI 的核心角色身份，如“你是一个xxx...”。
    * 一些API提供方**（如谷歌）**会'标记'预设的头部，当你发送的消息中包含被标记的预设头部时，可能会出现回复变慢，无法破限，甚至无限429报错等问题。
    * 自行修改预设头部以避免上述问题，请看后文'修改预设头部'部分。
*   **防429:** 🛡️ 在预设头部之前，一段包含随机宏的“乱码”。作用是绕过对头部的标记，有效果但不大。
*   **思维链:** ⛓️ 要求 AI 在正式回复前，先进行“思考”，并输出思考过程。一般来说，预设会明确以'思维链开始' '思维链结束'两个条目标识思维链的范围。对正文影响较大。
    * 如果角色卡有特殊要求，可按需修改或关闭思维链中的某部分。
*   **文风:** ✍️ 指导 AI 写作风格的条目，对正文影响巨大。
*   **禁词/反八股:** 🚫 尝试阻止 AI 使用特定词汇或表达方式。效果不好是正常的。
*   **防绝望/黑化/阴谋论:** 😊 字面意思，避免 AI 让角色在剧情中轻易陷入负面情绪或极端思维。
*   **小COT/段前思考:** 💡 一种在正文段落间插入微型思维链的技巧，常用于精细调整文风或抗绝望。
*   **防抢话:** 👤 防止 AI 代替你（用户，User，主控）进行描述或做出决定。
    *   ⚠️ **重要：** 启用此功能时，必须调低**预设条目内**的字数控制（不是滑条下面的那个最大回复长度（以词符数计））。
*   **反截断:** 🔓 当你发现 AI 开始出现空回复时，再开启此功能。它可以帮助绕过审查，生成完整回复。
    * **如果回复正常，请勿开启。**生成反截断使用的'免责声明'会影响正文质量，且反截断越长，越复杂，影响就越大。如要开启反截断，请从简单的开始尝试，若还是空回，再开启更强的（但同时只能开一个）。
*   **小总结/摘要:** 📑 让 AI 在每次回复后，附加一段对本次内容的摘要。配合正则功能，可以让久远的聊天记录只发送摘要部分，极大节约上下文空间。
    *   **注意：** 此功能只对开启后新生成的回复生效，且**必须与对应的正则功能一同开启或关闭。**
*   **字数控制:** 📈 要求 AI 的回复达到或不超过特定字数。由于 AI 并不真的知道自己写了多少字（不会数数），要求不可能被严格遵守，要求字数超高或超低时更是如此。
*   **总结前文:** 📜 也称"大总结"，一般位于预设底部。开启后，它会命令 AI 暂停角色扮演，仅对之前的全部对话进行一次全面总结。
*   **底部:** 🤔 位于预设最下方的几个条目。多用于卡思维链，重申用户输入，引导AI开始回复等。除非你知道自己在干什么，否则不要随意修改这部分。
    * 卡思维链: 让AI以为模型自带的思考已经结束了，以立刻开始以预设思维链进行思考（或者干脆不思考）。

---RAG-CHUNK---

### **“缝合”预设：将不同预设的优点组合成你的专属预设**

“缝合”预设，就是将一个预设的优秀部分（如独特的文风）移植到另一个预设中，实现强强联合。

**操作步骤：**

1.  **准备** 📝：复制你想要添加的功能的纯文本内容（例如，某个预设的文风条目）。
2.  **创建** ➕：打开目标预设，点击条目列表右侧的“添加”按钮，新建一个空白条目。
3.  **粘贴与命名** 💾：将复制的文本粘贴进去，为它取一个好记的名字（建议以 emoji 或符号等开头以便查找），然后点击保存。
4.  **插入** 🔗：在条目下拉列表中找到你刚创建的条目，选中它，然后点击右侧的“插入”（锁链图标）按钮。
5.  **拖动** ⭐：新条目会被置于列表顶部。按住其左侧的“星号”图标，将其拖动到合适的位置（例如，新的文风条目应放在旧的文风条目旁边）。
6.  **！！保存 ！！** 磁盘图标 💾：这是最关键的一步！酒馆**不会**自动保存你对预设的修改。完成上述操作后，请务必滚动到页面顶部，点击预设名称旁的“保存”按钮，否则一旦切换预设，所有修改都会丢失。

---RAG-CHUNK---

### **大总结：如何通过总结长对话为AI减负**

当对话过长，AI 会因“记忆”超载而变得健忘、混乱。此时，你需要“总结”来为它减负。

**逐步指南 (By Yoolieer):**

1.  **分批隐藏** 🙈：假设你有 100 条聊天记录。在输入框中输入以下命令来管理它们：
    *   输入 `/hide 0-100` 隐藏全部记录。
    *   输入 `/unhide 0-50` 仅显示前 50 条。
2.  **请求总结** ✍️：让 AI 对当前可见的 50 条内容进行总结。
    *   **方法A (使用预设):** 检查你的预设中是否有“总结前文”功能。若有，开启它，然后随便发送一个“1”即可触发总结。
    *   **方法B (手动输入):** 若预设无内置功能，直接发送以下指令：
        ```
        <Request:暂停剧情，本回合无需输出正文内容。请将之前发生的事进行总结，按时间或逻辑顺序保留关键信息，省略冗余描述>
        ```
3.  **重复操作** 🔄：总结完后，继续隐藏和显示下一批内容。
    *   输入 `/hide 0-50` 隐藏已总结的部分。
    *   输入 `/unhide 51-100` 显示后 50 条，让 AI 继续总结。
    *   💡 **建议：** 对于Gemini 2.5 Pro，每次让 AI 总结的文本量最好控制在 50k 字符以内。
4.  **保存总结** 📌：将 AI 生成的总结内容，复制到“世界书 (World Info)”中，并新建一个条目。建议将此条目置于角色定义之后，并开启“蓝灯”标记（使其永久生效）。
5.  **最终清理** 🧹：当所有内容都总结完毕后，使用 `/hide 0-x` (x 为你总结完的最后一条记录) 隐藏所有原始对话。建议保留最近的 5-10 条对话，这有助于 AI 维持当前的文风和格式。

**附加命令解析：**
*   `/hide x-y`：隐藏从第 x 到第 y “层”的对话，AI 将无法读取。
*   `/unhide x-y`：恢复从第 x 到第 y “层”的对话可见性。

---RAG-CHUNK---

### **如何正确更新角色卡以确保世界书同步**

⚠️ **重要提醒：** 角色卡页面的 `更多...` -> `替换/更新` 选项**无法正确更新**附带的世界书。请遵循以下正确流程：

1.  **访问世界书** 🌍：在角色卡界面，点击那个“绿色小地球”图标，进入当前绑定的世界书。
2.  **删除旧版** 🗑️：**删除**当前的世界书。成功后，角色卡界面的小地球图标会变回白色。
3.  **导入新卡** 📥：现在，返回角色卡界面，点击 `更多...` -> `替换/更新`，选择你的新版角色卡文件。酒馆会自动导入新卡附带的世界书。
4.  **确认绑定** ✅：新导入的世界书应该会自动绑定到角色卡上（小地球会再次变绿）。如果没变绿，请手动点击白色地球图标，选择刚才导入的世界书进行绑定。
5.  **(可选) 检查正则** 🔍：更新后，局部正则设置可能会被重置为关闭状态。请根据角色卡作者的建议，手动重新开启必要的正则。

---RAG-CHUNK---

### **酒馆内置工具与消息编辑功能 (“小铅笔”)**

**酒馆内置工具** (输入框左侧“三条横线”菜单):
*   **开始新聊天:** 在当前角色下开启一个全新的对话分支。
*   **管理聊天文件:** 切换、导出或删除已保存的聊天记录。
*   **删除消息:** 从最新一条回复开始，连续向上删除多条对话。
*   **重新生成:** 让 AI 重新生成它的最后一条回复。玩家们常称之为 "Roll" 或 "重 Roll"。

**“小铅笔” (消息右上角 ✏️ 图标):**
*   在黑色文本框中直接**修改**自己或 AI 的消息内容。
*   点击绿色 ✅ 按钮 **保存**你的编辑。
*   点击垃圾桶 🗑️ 按钮 **删除**单条消息（可以非连续删除）。
*   点击 ❌ 按钮 **放弃**编辑并退出。
*   💡 **技巧：** 编辑模式下显示的是未经正则处理的“原文”，有助于排查显示不全或格式错乱的问题。

---RAG-CHUNK---

### **管理、导出和导入聊天文件**

在“三条横线”菜单中点击**管理聊天文件**，可以进行以下操作：
*   **切换**: 直接点击聊天文件的预览部分，就能在同一角色的不同聊天文件间切换。
*   **导出**: 右上角的三个按钮分别是: 导出为jsonl格式，导出为txt格式，删除。
*   **导入**: 只有 `jsonl` 格式的聊天记录文件可以导入回酒馆。
*   **注意**: 导出的聊天记录是**未经正则处理的原文**，可能包含大量思维链、摘要等内容。