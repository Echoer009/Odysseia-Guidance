# 社区成员档案上传功能实施计划

## 功能概述
创建一个新的商店商品"社区成员档案上传"，定价100类脑币，允许用户上传别人的档案到社区成员数据库，不绑定用户ID，并在当前频道广播。

## 实施步骤

### 1. 添加新的效果ID
在 `src/chat/features/odysseia_coin/service/coin_service.py` 中添加：
```python
COMMUNITY_MEMBER_UPLOAD_EFFECT_ID = "upload_community_member"
```

### 2. 更新商店配置
在 `src/chat/config/shop_config.py` 中添加新商品：
```python
("社区成员档案上传", "上传社区成员的档案信息，不绑定用户ID", 100, "物品-贡献", "self", COMMUNITY_MEMBER_UPLOAD_EFFECT_ID),
```

### 3. 修改硬币服务处理逻辑
在 `purchase_item` 方法中添加对新效果的处理：
```python
elif item_effect == COMMUNITY_MEMBER_UPLOAD_EFFECT_ID:
    # 购买"社区成员档案上传"商品，需要弹出模态窗口
    return True, f"你花费了 {total_cost} 类脑币购买了 {quantity}x **{item['name']}**。", new_balance, True
```

### 4. 修改个人档案模态框
在 `src/chat/features/personal_memory/ui/profile_modal.py` 中：
- 添加一个开关来选择"上传别人的档案"
- 添加Discord ID输入字段（可选）
- 修改提交逻辑以支持社区成员保存

### 5. 实现社区成员保存功能
在 `src/chat/features/personal_memory/services/personal_memory_service.py` 中：
- 扩展 `save_user_profile` 方法或创建新的 `save_community_member_profile` 方法
- 支持不绑定用户ID的保存方式
- 实现广播功能

### 6. 实现广播功能
创建类似于世界书贡献的广播消息：
```python
embed = discord.Embed(
    title="✨ 新的社区成员档案！",
    description=f"**{interaction.user.display_name}** 上传了一个新的社区成员档案！",
    color=discord.Color.blue()
)
# 添加档案信息字段
await interaction.channel.send(embed=embed)
```

## 数据库结构
使用现有的 `community_members` 表：
- `id`: 自动生成的唯一ID
- `title`: 档案标题
- `discord_number_id`: 可为空（不绑定用户）
- `content_json`: 档案内容JSON

## 测试流程
1. 用户购买"社区成员档案上传"商品
2. 弹出模态框填写档案信息
3. 选择"上传别人的档案"选项
4. 提交后保存到数据库
5. 在当前频道发送广播消息
6. 验证数据正确保存且不绑定用户ID